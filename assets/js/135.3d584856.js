(window.webpackJsonp=window.webpackJsonp||[]).push([[135],{603:function(s,e,a){"use strict";a.r(e);var t=a(10),r=Object(t.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"安装docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")]),s._v(" 安装Docker")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://docs.docker.com/engine/install/debian/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方安装、卸载文档"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("参考"),e("a",{attrs:{href:"https://www.runoob.com/docker/centos-docker-install.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("菜鸟教程"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("安装 Docker Engine-Community\n"),e("code",[s._v("curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun")])]),s._v(" "),e("p",[s._v("启动"),e("code",[s._v("service docker start")])]),s._v(" "),e("p",[s._v("开机自启"),e("code",[s._v("systemctl enable docker")])]),s._v(" "),e("p",[s._v("删除安装包"),e("code",[s._v("yum remove docker-ce")])]),s._v(" "),e("p",[s._v("删除镜像容器配置文件"),e("code",[s._v("rm -rf /var/lib/docker")])]),s._v(" "),e("h3",{attrs:{id:"配置监听端口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置监听端口"}},[s._v("#")]),s._v(" 配置监听端口")]),s._v(" "),e("p",[e("code",[s._v("vi /lib/systemd/system/docker.service")])]),s._v(" "),e("p",[s._v("找到"),e("code",[s._v("ExecStart")]),s._v("行,修改为:"),e("code",[s._v("ExecStart=/usr/bin/dockerd -H unix:///var/run/docker.sock -H tcp://0.0.0.0:2375")]),s._v("\n重新加载 systemd 的配置，并重启 Docker 服务：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("systemctl daemon-reload\nsystemctl restart "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"安装docker-compose"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装docker-compose"}},[s._v("#")]),s._v(" 安装Docker Compose")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://docs.docker.com/compose/install/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),e("OutboundLink")],1),s._v(" "),e("a",{attrs:{href:"https://github.com/docker/compose/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("版本列表"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("通过二进制文件安装\n"),e("code",[s._v('curl -L "https://github.com/docker/compose/releases/download/(版本号)/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose')]),s._v("\n以"),e("code",[s._v("v2.23.3")]),s._v("为例")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://ghproxy.net/https://github.com/docker/compose/releases/download/v2.23.3/docker-compose-'),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("-"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /usr/local/bin/docker-compose\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://ghproxy.net/https://github.com/docker/compose/releases/download/v2.23.3/docker-compose-'),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("-"),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" /usr/local/bin/docker-compose\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[e("code",[s._v("chmod +x /usr/local/bin/docker-compose")])]),s._v(" "),e("p",[e("code",[s._v("docker-compose version")])]),s._v(" "),e("h3",{attrs:{id:"问题记录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题记录"}},[s._v("#")]),s._v(" 问题记录")]),s._v(" "),e("ol",[e("li",[s._v("在"),e("code",[s._v("Armbian")]),s._v("系统安装后，执行出现"),e("code",[s._v("docker-compose version")]),s._v("报错"),e("code",[s._v("/usr/local/bin")]),s._v("路径下找不到"),e("code",[s._v("docker-compose")]),s._v("命令。")])]),s._v(" "),e("p",[e("code",[s._v("echo $PATH")]),s._v("发现该目录在环境变量中。")]),s._v(" "),e("p",[s._v("权限也给了，找不出原因，干脆删除该文件，换一种方式安装。")]),s._v(" "),e("p",[s._v("参照官方文档给的命令：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-compose-plugin\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("安装后执行"),e("code",[s._v("docker-compose version")]),s._v("，话说报错找不到"),e("code",[s._v("docker-compose")]),s._v("命令，不过这次没有提"),e("code",[s._v("/usr/local/bin")]),s._v("，猜测是没放到可执行目录下，")]),s._v(" "),e("p",[s._v("看看"),e("code",[s._v("docker-compose")]),s._v("的安装目录:")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" info "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--format")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{range .ClientInfo.Plugins}}{{if eq .Name \"compose\"}}{{.Path}}{{end}}{{end}}'")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("输出"),e("code",[s._v("/usr/libexec/docker/cli-plugins/docker-compose")])]),s._v(" "),e("p",[s._v("给该文件创建一个软连接到可执行目录下")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /usr/libexec/docker/cli-plugins/docker-compose /usr/local/bin/docker-compose\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("再次运行"),e("code",[s._v("docker-compose")]),s._v("命令，成功输出版本信息。")]),s._v(" "),e("h2",{attrs:{id:"修改配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改配置"}},[s._v("#")]),s._v(" 修改配置")]),s._v(" "),e("p",[s._v("修改/etc/docker/daemon.json文件，如果没有先建一个即可")]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"registry-mirrors"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://hub.littlediary.cn"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://docker.m.daocloud.io"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://hub.crdz.gq"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://hub.firefly.store"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://docker.unsee.tech"')]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("使配置生效")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("systemctl daemon-reload\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" restart\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" info\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"使用代理网络"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用代理网络"}},[s._v("#")]),s._v(" 使用代理网络")]),s._v(" "),e("ol",[e("li",[s._v("创建"),e("code",[s._v("dockerd")]),s._v("相关的"),e("code",[s._v("systemd")]),s._v("目录，这个目录下的配置将覆盖"),e("code",[s._v("dockerd")]),s._v("的默认配置")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /etc/systemd/system/docker.service.d\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("新建配置文件 "),e("code",[s._v("/etc/systemd/system/docker.service.d/http-proxy.conf")]),s._v("，这个文件中将包含环境变量:")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HTTP_PROXY=http://proxy.example.com:80"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HTTPS_PROXY=https://proxy.example.com:443"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NO_PROXY=your-registry.com,10.10.10.10,*.example.com"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("多个 "),e("code",[s._v("NO_PROXY")]),s._v(" 变量的值用逗号分隔，而且可以使用通配符"),e("code",[s._v("*")]),s._v("，极端情况下，如果 "),e("code",[s._v("NO_PROXY=*")]),s._v("，那么所有请求都将不通过代理服务器。")]),s._v(" "),e("p",[s._v("重新加载配置文件，重启 "),e("code",[s._v("dockerd")]),s._v(" 服务")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("systemctl daemon-reload\nsystemctl restart "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("检查确认环境变量已经正确配置：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("systemctl show "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--property")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Environment "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" info "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" proxy\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])])}),[],!1,null,null,null);e.default=r.exports}}]);