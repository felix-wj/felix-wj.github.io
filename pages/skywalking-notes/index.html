<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Skywalking笔记 | Felix&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.4">
    <link rel="icon" href="/img/宇航员.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
    <meta name="description" content="记录工作、学习与生活">
    <meta name="keywords" content="个人技术博客,技术文档,学习,面试,Java,JVM,Spring,MQ,Mybatis,Mysql,Docker,Linux,git">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.01205ba6.css" as="style"><link rel="preload" href="/assets/js/app.eb9ad15b.js" as="script"><link rel="preload" href="/assets/js/2.23133a41.js" as="script"><link rel="preload" href="/assets/js/96.cbda6537.js" as="script"><link rel="prefetch" href="/assets/js/10.7cdde849.js"><link rel="prefetch" href="/assets/js/100.980dcc4d.js"><link rel="prefetch" href="/assets/js/101.2bc32e65.js"><link rel="prefetch" href="/assets/js/102.67e0d97e.js"><link rel="prefetch" href="/assets/js/103.5e38c237.js"><link rel="prefetch" href="/assets/js/104.785f4bf1.js"><link rel="prefetch" href="/assets/js/105.7216cf88.js"><link rel="prefetch" href="/assets/js/106.357cb171.js"><link rel="prefetch" href="/assets/js/107.9ad6ed9f.js"><link rel="prefetch" href="/assets/js/108.022c8e67.js"><link rel="prefetch" href="/assets/js/109.791da8c1.js"><link rel="prefetch" href="/assets/js/11.4f29d78a.js"><link rel="prefetch" href="/assets/js/110.c59e1bc2.js"><link rel="prefetch" href="/assets/js/111.18efda98.js"><link rel="prefetch" href="/assets/js/112.1c6abb72.js"><link rel="prefetch" href="/assets/js/113.1ef5e2b5.js"><link rel="prefetch" href="/assets/js/114.97962b71.js"><link rel="prefetch" href="/assets/js/115.de2b30dd.js"><link rel="prefetch" href="/assets/js/116.35dfabbc.js"><link rel="prefetch" href="/assets/js/117.0c9b02f7.js"><link rel="prefetch" href="/assets/js/118.89f97796.js"><link rel="prefetch" href="/assets/js/119.ea45cb65.js"><link rel="prefetch" href="/assets/js/12.aa6f7a7d.js"><link rel="prefetch" href="/assets/js/120.dbbd7146.js"><link rel="prefetch" href="/assets/js/121.77b7d4ca.js"><link rel="prefetch" href="/assets/js/122.870de410.js"><link rel="prefetch" href="/assets/js/123.0a4fb937.js"><link rel="prefetch" href="/assets/js/124.839c8e3e.js"><link rel="prefetch" href="/assets/js/125.8da3001c.js"><link rel="prefetch" href="/assets/js/126.fac8a931.js"><link rel="prefetch" href="/assets/js/127.e339e927.js"><link rel="prefetch" href="/assets/js/128.7a500c8d.js"><link rel="prefetch" href="/assets/js/129.72564fc9.js"><link rel="prefetch" href="/assets/js/13.2131f777.js"><link rel="prefetch" href="/assets/js/130.78dd1aec.js"><link rel="prefetch" href="/assets/js/131.0fed8bc4.js"><link rel="prefetch" href="/assets/js/132.a2b09b19.js"><link rel="prefetch" href="/assets/js/133.76d1273b.js"><link rel="prefetch" href="/assets/js/134.528d99ad.js"><link rel="prefetch" href="/assets/js/135.3d584856.js"><link rel="prefetch" href="/assets/js/136.c1af8e7c.js"><link rel="prefetch" href="/assets/js/137.d5fc0704.js"><link rel="prefetch" href="/assets/js/138.02b6c14c.js"><link rel="prefetch" href="/assets/js/139.4730dbeb.js"><link rel="prefetch" href="/assets/js/14.d0672bc2.js"><link rel="prefetch" href="/assets/js/140.e74b1bde.js"><link rel="prefetch" href="/assets/js/141.cb7da4fd.js"><link rel="prefetch" href="/assets/js/142.71aa5c51.js"><link rel="prefetch" href="/assets/js/143.09854d2e.js"><link rel="prefetch" href="/assets/js/144.d5cf1921.js"><link rel="prefetch" href="/assets/js/145.c5659f9e.js"><link rel="prefetch" href="/assets/js/146.06cfa5c8.js"><link rel="prefetch" href="/assets/js/147.9997c2db.js"><link rel="prefetch" href="/assets/js/148.ce26cdde.js"><link rel="prefetch" href="/assets/js/149.f524e2e8.js"><link rel="prefetch" href="/assets/js/15.bbfaf7a2.js"><link rel="prefetch" href="/assets/js/150.c1817272.js"><link rel="prefetch" href="/assets/js/151.33936f14.js"><link rel="prefetch" href="/assets/js/152.e2fea32b.js"><link rel="prefetch" href="/assets/js/153.973d10f5.js"><link rel="prefetch" href="/assets/js/154.eb9bcfdb.js"><link rel="prefetch" href="/assets/js/155.305e0ef5.js"><link rel="prefetch" href="/assets/js/156.cdc5f44b.js"><link rel="prefetch" href="/assets/js/157.72435330.js"><link rel="prefetch" href="/assets/js/158.69753983.js"><link rel="prefetch" href="/assets/js/159.98814091.js"><link rel="prefetch" href="/assets/js/16.2f65b413.js"><link rel="prefetch" href="/assets/js/160.26699746.js"><link rel="prefetch" href="/assets/js/161.d1830608.js"><link rel="prefetch" href="/assets/js/162.eda4bb16.js"><link rel="prefetch" href="/assets/js/163.549b6ccb.js"><link rel="prefetch" href="/assets/js/164.e469d1d1.js"><link rel="prefetch" href="/assets/js/165.019c87ee.js"><link rel="prefetch" href="/assets/js/166.03b99260.js"><link rel="prefetch" href="/assets/js/167.341b86e9.js"><link rel="prefetch" href="/assets/js/168.600b1bae.js"><link rel="prefetch" href="/assets/js/169.031651c7.js"><link rel="prefetch" href="/assets/js/17.7518d81f.js"><link rel="prefetch" href="/assets/js/170.501a08fa.js"><link rel="prefetch" href="/assets/js/171.8aaa9f1e.js"><link rel="prefetch" href="/assets/js/172.3841652c.js"><link rel="prefetch" href="/assets/js/173.8988075f.js"><link rel="prefetch" href="/assets/js/174.79b63cdd.js"><link rel="prefetch" href="/assets/js/18.70ff7808.js"><link rel="prefetch" href="/assets/js/19.d1c11980.js"><link rel="prefetch" href="/assets/js/20.905150d6.js"><link rel="prefetch" href="/assets/js/21.b83f97c2.js"><link rel="prefetch" href="/assets/js/22.3237d975.js"><link rel="prefetch" href="/assets/js/23.b6ceeddc.js"><link rel="prefetch" href="/assets/js/24.f6d3bff1.js"><link rel="prefetch" href="/assets/js/25.13a2b436.js"><link rel="prefetch" href="/assets/js/26.1c05a2d1.js"><link rel="prefetch" href="/assets/js/27.4c294e07.js"><link rel="prefetch" href="/assets/js/28.d78f6691.js"><link rel="prefetch" href="/assets/js/29.2a4d2cb9.js"><link rel="prefetch" href="/assets/js/3.692e2bfd.js"><link rel="prefetch" href="/assets/js/30.ab8fecd4.js"><link rel="prefetch" href="/assets/js/31.b9bc583f.js"><link rel="prefetch" href="/assets/js/32.935003c6.js"><link rel="prefetch" href="/assets/js/33.ab6d58f6.js"><link rel="prefetch" href="/assets/js/34.3944e91a.js"><link rel="prefetch" href="/assets/js/35.0f94ab46.js"><link rel="prefetch" href="/assets/js/36.919e34e1.js"><link rel="prefetch" href="/assets/js/37.28e81abb.js"><link rel="prefetch" href="/assets/js/38.bb880c02.js"><link rel="prefetch" href="/assets/js/39.231d28bf.js"><link rel="prefetch" href="/assets/js/4.e678a16d.js"><link rel="prefetch" href="/assets/js/40.7be670c8.js"><link rel="prefetch" href="/assets/js/41.a7963b85.js"><link rel="prefetch" href="/assets/js/42.5b51c283.js"><link rel="prefetch" href="/assets/js/43.b5b35b14.js"><link rel="prefetch" href="/assets/js/44.efcb5657.js"><link rel="prefetch" href="/assets/js/45.711758a1.js"><link rel="prefetch" href="/assets/js/46.cc03e60e.js"><link rel="prefetch" href="/assets/js/47.a222a1fb.js"><link rel="prefetch" href="/assets/js/48.4f74137b.js"><link rel="prefetch" href="/assets/js/49.e1c0b25a.js"><link rel="prefetch" href="/assets/js/5.e28dc52b.js"><link rel="prefetch" href="/assets/js/50.2f74f50b.js"><link rel="prefetch" href="/assets/js/51.5c73434e.js"><link rel="prefetch" href="/assets/js/52.a1df40bd.js"><link rel="prefetch" href="/assets/js/53.9f0380f8.js"><link rel="prefetch" href="/assets/js/54.89e40a67.js"><link rel="prefetch" href="/assets/js/55.151dfaa1.js"><link rel="prefetch" href="/assets/js/56.1d3bae46.js"><link rel="prefetch" href="/assets/js/57.c184b7ac.js"><link rel="prefetch" href="/assets/js/58.ef1888e8.js"><link rel="prefetch" href="/assets/js/59.2c50916d.js"><link rel="prefetch" href="/assets/js/6.1a7cfdf7.js"><link rel="prefetch" href="/assets/js/60.6d9489da.js"><link rel="prefetch" href="/assets/js/61.11384b32.js"><link rel="prefetch" href="/assets/js/62.6e08233e.js"><link rel="prefetch" href="/assets/js/63.63d6adf4.js"><link rel="prefetch" href="/assets/js/64.0effdb87.js"><link rel="prefetch" href="/assets/js/65.5ce63892.js"><link rel="prefetch" href="/assets/js/66.a4ecf595.js"><link rel="prefetch" href="/assets/js/67.ec8bfd04.js"><link rel="prefetch" href="/assets/js/68.0b97decc.js"><link rel="prefetch" href="/assets/js/69.d3b2ae74.js"><link rel="prefetch" href="/assets/js/7.17f370cb.js"><link rel="prefetch" href="/assets/js/70.0cc15e88.js"><link rel="prefetch" href="/assets/js/71.c6dff523.js"><link rel="prefetch" href="/assets/js/72.de8c5590.js"><link rel="prefetch" href="/assets/js/73.4635238f.js"><link rel="prefetch" href="/assets/js/74.f474c496.js"><link rel="prefetch" href="/assets/js/75.f576a747.js"><link rel="prefetch" href="/assets/js/76.08efb6a5.js"><link rel="prefetch" href="/assets/js/77.50c85ad6.js"><link rel="prefetch" href="/assets/js/78.35485554.js"><link rel="prefetch" href="/assets/js/79.12cba4be.js"><link rel="prefetch" href="/assets/js/8.ebc35f9f.js"><link rel="prefetch" href="/assets/js/80.bd58ec06.js"><link rel="prefetch" href="/assets/js/81.a097bc8c.js"><link rel="prefetch" href="/assets/js/82.76509046.js"><link rel="prefetch" href="/assets/js/83.ba84ce6e.js"><link rel="prefetch" href="/assets/js/84.a0b85942.js"><link rel="prefetch" href="/assets/js/85.d0b3f5b9.js"><link rel="prefetch" href="/assets/js/86.c3af65ab.js"><link rel="prefetch" href="/assets/js/87.b2df53a3.js"><link rel="prefetch" href="/assets/js/88.9ec463fd.js"><link rel="prefetch" href="/assets/js/89.87e5ff97.js"><link rel="prefetch" href="/assets/js/9.34e94d86.js"><link rel="prefetch" href="/assets/js/90.107a3efe.js"><link rel="prefetch" href="/assets/js/91.f2dd48d8.js"><link rel="prefetch" href="/assets/js/92.d3c550be.js"><link rel="prefetch" href="/assets/js/93.ed732369.js"><link rel="prefetch" href="/assets/js/94.77391a93.js"><link rel="prefetch" href="/assets/js/95.e7d3207f.js"><link rel="prefetch" href="/assets/js/97.a3747d17.js"><link rel="prefetch" href="/assets/js/98.854a59ec.js"><link rel="prefetch" href="/assets/js/99.2e1c8ba8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.01205ba6.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/小天鹅.svg" alt="Felix's Blog" class="logo"> <span class="site-name can-hide">Felix's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><!----> <span class="title" style="display:;">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/note/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/note/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/note/linux/" class="nav-link">服务器运维</a></li><li class="dropdown-item"><!----> <a href="/note/web/" class="nav-link">前端</a></li><li class="dropdown-item"><!----> <a href="/note/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/note/design/pattern/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool" class="dropdown-title"><!----> <span class="title" style="display:;">Tool</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/e7ab16/" class="nav-link">MyBatis Log 转SQL</a></li><li class="dropdown-item"><!----> <a href="/pages/data-formate-tool/" class="nav-link">数据列转行工具</a></li><li class="dropdown-item"><!----> <a href="https://wangchujiang.com/git-tips/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Git Tips
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.markdown.xyz/basic-syntax/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Markdown语法指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github-emoji-picker.rickstaa.dev/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub Emoji Picker
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.iszy.cc/posts/15/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Markdown代码块语言清单
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/felix-wj/felix-wj.github.io.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/小天鹅.png"> <div class="blogger-info"><h3>Felix</h3> <span></span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><!----> <span class="title" style="display:;">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/note/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/note/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/note/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/note/linux/" class="nav-link">服务器运维</a></li><li class="dropdown-item"><!----> <a href="/note/web/" class="nav-link">前端</a></li><li class="dropdown-item"><!----> <a href="/note/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/note/design/pattern/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tool" class="dropdown-title"><!----> <span class="title" style="display:;">Tool</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/e7ab16/" class="nav-link">MyBatis Log 转SQL</a></li><li class="dropdown-item"><!----> <a href="/pages/data-formate-tool/" class="nav-link">数据列转行工具</a></li><li class="dropdown-item"><!----> <a href="https://wangchujiang.com/git-tips/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Git Tips
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.markdown.xyz/basic-syntax/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Markdown语法指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github-emoji-picker.rickstaa.dev/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub Emoji Picker
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.iszy.cc/posts/15/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Markdown代码块语言清单
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/felix-wj/felix-wj.github.io.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Skywalking笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/skywalking-notes/#服务端部署" class="sidebar-link">服务端部署</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/skywalking-notes/#java-agent" class="sidebar-link">Java Agent</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/skywalking-notes/#服务器监控" class="sidebar-link">服务器监控</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/skywalking-notes/#node-exporter" class="sidebar-link">node-exporter</a></li><li class="sidebar-sub-header"><a href="/pages/skywalking-notes/#opentelemetry-collector" class="sidebar-link">opentelemetry-collector</a></li></ul></li><li><a href="/pages/skywalking-notes/#监控日志清理" class="sidebar-link">监控日志清理</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-3b89dcb4><div class="articleInfo" data-v-3b89dcb4><!----> <div class="info" data-v-3b89dcb4><div title="作者" class="author iconfont icon-touxiang" data-v-3b89dcb4><a href="https://github.com/felix-wj" target="_blank" title="作者" class="beLink" data-v-3b89dcb4>felix</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-3b89dcb4><a href="javascript:;" data-v-3b89dcb4>2024-11-21</a></div> <div title="分类" class="date iconfont icon-wenjian" data-v-3b89dcb4><a href="/categories/?category=%E9%9A%8F%E7%AC%94" data-v-3b89dcb4>随笔 </a></div></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">
          Skywalking笔记
        </h1> <!----> <div class="theme-vdoing-content content__default"><p>Skywalking是一个开源的应用性能监控系统，提供分布式追踪、性能指标分析、应用拓扑分析等功能。</p> <p>架构分为三部分：
- OAP：数据处理、存储
- UI：数据展示
- Agent：数据采集</p> <h2 id="服务端部署"><a href="#服务端部署" class="header-anchor">#</a> 服务端部署</h2> <p>通过<code>docker-compose</code>部署Skywalking，编写<code>docker-compose.yml</code>文件：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">skywalking-oap-server</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> apache/skywalking<span class="token punctuation">-</span>oap<span class="token punctuation">-</span>server<span class="token punctuation">:</span>10.1.0
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> skywalking<span class="token punctuation">-</span>oap<span class="token punctuation">-</span>server
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token comment"># 端口映射</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;11800:11800&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;12800:12800&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./config/oap/alarm<span class="token punctuation">-</span>settings.yml<span class="token punctuation">:</span>/skywalking/config/alarm<span class="token punctuation">-</span>settings.yml
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">SW_HEALTH_CHECKER</span><span class="token punctuation">:</span> default
      <span class="token key atrule">SW_STORAGE</span><span class="token punctuation">:</span> elasticsearch
      <span class="token key atrule">SW_ENABLE_UPDATE_UI_TEMPLATE</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
      <span class="token key atrule">SW_STORAGE_ES_CLUSTER_NODES</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>ES_IP<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>ES_PORT<span class="token punctuation">}</span>
      <span class="token key atrule">JAVA_OPTS</span><span class="token punctuation">:</span> <span class="token string">&quot;-Xms512m -Xmx512m&quot;</span>
      <span class="token key atrule">TZ</span><span class="token punctuation">:</span> Asia/Shanghai
      <span class="token key atrule">SW_TELEMETRY</span><span class="token punctuation">:</span> prometheus
  <span class="token key atrule">skywalking-ui</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> apache/skywalking<span class="token punctuation">-</span>ui<span class="token punctuation">:</span>10.1.0
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> skywalking<span class="token punctuation">-</span>ui
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> skywalking<span class="token punctuation">-</span>oap<span class="token punctuation">-</span>server
    <span class="token key atrule">links</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> skywalking<span class="token punctuation">-</span>oap<span class="token punctuation">-</span>server
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;8051:8080&quot;</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">SW_OAP_ADDRESS</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//skywalking<span class="token punctuation">-</span>oap<span class="token punctuation">-</span>server<span class="token punctuation">:</span><span class="token number">12800</span>
      <span class="token key atrule">TZ</span><span class="token punctuation">:</span> Asia/Shanghai
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>skywalking默认使用H2数据库，可以通过<code>SW_STORAGE</code>环境变量指定使用的存储，可以作为验证功能临时使用。</p> <p>skywalking支持配置MySQL存储，但是由于开源协议不同，需要自己引入MySQL驱动。</p> <p>实际测试发现，直接将驱动jar包放入<code>/skywalking/oap-libs</code>目录下，运行时可以被程序加载，但是依旧会报错没有合适的驱动。</p> <p>在原镜像的基础上，自己构建镜像，将MySQL驱动jar包放入<code>/skywalking/oap-libs</code>目录下，通过自己构建的镜像运行，不再报错找不到驱动，但是无法连接到指定的MySQL数据库。配置的MySQL 用户名、链接地址失效，总是连接root@机器公网IP。 未找到解决办法，放弃使用MySQL存储。</p> <p>况且使用MySQL存储，会影响后续数据处理性能，也不利于存储扩展。所以选择使用ElasticSearch存储。</p> <h2 id="java-agent"><a href="#java-agent" class="header-anchor">#</a> Java Agent</h2> <p>由于通过Docker部署java应用，为了方便使用，将agent打包到应用镜像中。</p> <p>编写Dockerfile：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> openjdk:8-jdk</span>
<span class="token instruction"><span class="token keyword">ENV</span> TZ=Asia/Shanghai</span>
<span class="token comment"># SkyWalking Agent</span>
<span class="token instruction"><span class="token keyword">COPY</span> skywalking-agent-9.0.0 ./skywalking-agent</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>部署java应用的Dockerfile：</p> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> jdk8:baseImage</span>

<span class="token instruction"><span class="token keyword">ARG</span> appName</span>

<span class="token instruction"><span class="token keyword">ENV</span> APP_NAME=<span class="token variable">${appName}</span></span>

<span class="token instruction"><span class="token keyword">ENV</span> SW_AGENT_NAME=<span class="token variable">${appName}</span></span>

<span class="token instruction"><span class="token keyword">ENV</span> SW_AGENT_COLLECTOR_BACKEND_SERVICES=<span class="token variable">${oapIp}</span>:11800</span>

<span class="token instruction"><span class="token keyword">COPY</span> *.jar /app.jar</span>

<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;tini&quot;</span>, <span class="token string">&quot;--&quot;</span>, <span class="token string">&quot;sh&quot;</span>, <span class="token string">&quot;-c&quot;</span>, <span class="token string">&quot; exec java -jar  -javaagent:/skywalking-agent/skywalking-agent.jar -Dskywalking.trace.ignore_path=/resources/**,Redisson/**,Lettuce/**,Mysql/JDBI/**,/nacos/**,Mysql/JDBC/**,HikariCP/**   /app.jar&quot;</span>]</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="服务器监控"><a href="#服务器监控" class="header-anchor">#</a> 服务器监控</h2> <p>通过node-exporter采集服务器监控数据，通过opentelemetry-collector抓取数据，上报到skywalking。</p> <h3 id="node-exporter"><a href="#node-exporter" class="header-anchor">#</a> node-exporter</h3> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">node-exporter</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> prom/node<span class="token punctuation">-</span>exporter<span class="token punctuation">:</span>v1
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>exporter
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>exporter
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;9100:9100&quot;</span> 
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /proc<span class="token punctuation">:</span>/host/proc<span class="token punctuation">:</span>ro
      <span class="token punctuation">-</span> /sys<span class="token punctuation">:</span>/host/sys<span class="token punctuation">:</span>ro
      <span class="token punctuation">-</span> /<span class="token punctuation">:</span>/rootfs<span class="token punctuation">:</span>ro
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>部署到服务器上，通过<code>9100</code>端口访问。</p> <h3 id="opentelemetry-collector"><a href="#opentelemetry-collector" class="header-anchor">#</a> opentelemetry-collector</h3> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">otel-collector</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> otel/opentelemetry<span class="token punctuation">-</span>collector<span class="token punctuation">:</span>0.113.0
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> otel<span class="token punctuation">-</span>collector
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;--config=/etc/otel-collector-config.yaml&quot;</span> <span class="token punctuation">]</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> skywalking<span class="token punctuation">-</span>oap<span class="token punctuation">-</span>server
    <span class="token key atrule">links</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> skywalking<span class="token punctuation">-</span>oap<span class="token punctuation">-</span>server
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./config/opentelemetry/otel<span class="token punctuation">-</span>collector<span class="token punctuation">-</span>config.yaml<span class="token punctuation">:</span>/etc/otel<span class="token punctuation">-</span>collector<span class="token punctuation">-</span>config.yaml
    <span class="token key atrule">expose</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token number">55678</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><code>otel-collector-config.yaml</code>配置文件：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">receivers</span><span class="token punctuation">:</span>
  <span class="token key atrule">prometheus</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">&quot;vm-monitoring&quot;</span> <span class="token comment"># make sure to use this in the vm.yaml to filter only VM metrics</span>
          <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 10s
          <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.1.1:9100&quot;</span><span class="token punctuation">]</span> 
<span class="token key atrule">processors</span><span class="token punctuation">:</span>
  <span class="token key atrule">batch</span><span class="token punctuation">:</span>
<span class="token key atrule">exporters</span><span class="token punctuation">:</span>
  <span class="token key atrule">otlp</span><span class="token punctuation">:</span>
    <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> <span class="token string">&quot;skywalking-oap-server:11800&quot;</span> <span class="token comment"># The OAP Server address</span>
    <span class="token comment"># The config format of OTEL version prior to 0.34.0, eg. 0.29.0, should be:</span>
    <span class="token comment"># insecure: true</span>
    <span class="token key atrule">tls</span><span class="token punctuation">:</span>
      <span class="token key atrule">insecure</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#insecure: true</span>
<span class="token key atrule">service</span><span class="token punctuation">:</span>
  <span class="token key atrule">pipelines</span><span class="token punctuation">:</span>
    <span class="token key atrule">metrics</span><span class="token punctuation">:</span>
      <span class="token key atrule">receivers</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>prometheus<span class="token punctuation">]</span>
      <span class="token key atrule">processors</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>batch<span class="token punctuation">]</span>
      <span class="token key atrule">exporters</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>otlp<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>可以写到oap和UI的docker-compose.yml文件中，一起部署。</p> <h2 id="监控日志清理"><a href="#监控日志清理" class="header-anchor">#</a> 监控日志清理</h2> <p>日志写入<code>Elasticsearch</code>，上报日志数据量大，需要定期清理</p> <p>起初尝试使用elasticsearch-curator工具清理，但是该工具在判断数据量条件时采用的是多个索引累加，然后删除超过数量之后的索引，累加的顺序逻辑复杂，无法批量处理针对单个系列的索引，例如 <code>sw_segment-*</code>,<code>sw_log-*</code>,遂放弃。</p> <p>转而使用Elasticsearch提供的ILM(索引生命周期管理)工具。通过索引的年龄、文档数、数据量触发条件，滚动到新索引，将原索引删除。但是由于Skywalking写入索引不支持自定义，滚动生成的新索引无法被Skywalking识别，会导致skywalking写入失败，也放弃。</p> <p>最终通过shell脚本灵活删除日志：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 参数</span>
<span class="token comment"># $1: 删除索引的大小阈值，单位为GB</span>
<span class="token comment"># $2: 删除索引的年龄阈值，单位为天</span>

<span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>
<span class="token comment"># Elasticsearch 主机和端口</span>
<span class="token assign-left variable">ES_HOST</span><span class="token operator">=</span>

<span class="token function-name function">del_by_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token assign-left variable">del_size</span><span class="token operator">=</span><span class="token variable">$1</span>

    <span class="token comment"># 获取所有 sw_* 开头的索引及其大小</span>
    <span class="token assign-left variable">indices</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">&quot;<span class="token variable">$ES_HOST</span>/_cat/indices/sw_*?h=index,store.size&amp;format=json&quot;</span><span class="token variable">)</span></span>
    <span class="token comment"># 遍历每个索引</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$indices</span>&quot;</span> <span class="token operator">|</span> jq <span class="token parameter variable">-c</span> <span class="token string">'.[]'</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> index<span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token assign-left variable">index_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$index</span>&quot;</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.index'</span><span class="token variable">)</span></span>
        <span class="token comment"># 排除 sw_management</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$index_name</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;sw_management&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token builtin class-name">continue</span>
        <span class="token keyword">fi</span>
        <span class="token assign-left variable">index_size</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$index</span>&quot;</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.[&quot;store.size&quot;]'</span><span class="token variable">)</span></span>

        <span class="token comment"># 将大小转换为字节</span>
        <span class="token assign-left variable">size_in_bytes</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$index_size</span>&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/[bB]//g'</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/k/K/g; s/m/M/g; s/g/G/g; s/t/T/g'</span> <span class="token operator">|</span> numfmt <span class="token parameter variable">--from</span><span class="token operator">=</span>iec<span class="token variable">)</span></span>
        <span class="token comment"># 如果大小超过 nGB，则删除索引</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$size_in_bytes</span>&quot;</span> <span class="token parameter variable">-gt</span> <span class="token string">&quot;<span class="token variable">$del_size</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token builtin class-name">echo</span> <span class="token string">&quot;Deleting index <span class="token variable">$index_name</span> with size <span class="token variable">$index_size</span>&quot;</span>
            <span class="token function">curl</span> <span class="token parameter variable">-X</span> DELETE <span class="token string">&quot;<span class="token variable">$ES_HOST</span>/<span class="token variable">$index_name</span>&quot;</span>
            <span class="token comment">#换行</span>
            <span class="token builtin class-name">echo</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span>
<span class="token punctuation">}</span>

<span class="token comment"># 删除超过n天的索引</span>
<span class="token function-name function">del_by_age</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token assign-left variable">del_age</span><span class="token operator">=</span><span class="token variable">$1</span>
    <span class="token comment"># 获取所有 sw_* 开头的索引及其创建时间</span>
    <span class="token assign-left variable">indices</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token string">&quot;<span class="token variable">$ES_HOST</span>/_cat/indices/sw_*?h=index,creation.date.string&amp;format=json&quot;</span><span class="token variable">)</span></span>

    <span class="token comment"># 当前日期的时间戳</span>
    <span class="token assign-left variable">current_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%s<span class="token variable">)</span></span>

    <span class="token comment"># 遍历每个索引</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$indices</span>&quot;</span> <span class="token operator">|</span> jq <span class="token parameter variable">-c</span> <span class="token string">'.[]'</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> <span class="token parameter variable">-r</span> index<span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token assign-left variable">index_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$index</span>&quot;</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.index'</span><span class="token variable">)</span></span>
        <span class="token comment">## 排除 sw_management</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$index_name</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;sw_management&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token builtin class-name">continue</span>
        <span class="token keyword">fi</span>
        <span class="token assign-left variable">creation_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$index</span>&quot;</span> <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> <span class="token string">'.[&quot;creation.date.string&quot;]'</span><span class="token variable">)</span></span>

        <span class="token comment"># 将创建日期转换为时间戳</span>
        <span class="token assign-left variable">creation_timestamp</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">&quot;<span class="token variable">$creation_date</span>&quot;</span> +%s<span class="token variable">)</span></span>

        <span class="token comment"># 计算索引的年龄（天）</span>
        <span class="token assign-left variable">age</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span><span class="token punctuation">(</span>current_date <span class="token operator">-</span> creation_timestamp<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">86400</span><span class="token variable">))</span></span>

        <span class="token comment"># 如果年龄超过n天，则删除索引</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$age</span>&quot;</span> <span class="token parameter variable">-gt</span> <span class="token string">&quot;<span class="token variable">$del_age</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token builtin class-name">echo</span> <span class="token string">&quot;Deleting index <span class="token variable">$index_name</span> created on <span class="token variable">$creation_date</span>&quot;</span>
            <span class="token function">curl</span> <span class="token parameter variable">-X</span> DELETE <span class="token string">&quot;<span class="token variable">$ES_HOST</span>/<span class="token variable">$index_name</span>&quot;</span>
            <span class="token comment">#换行</span>
            <span class="token builtin class-name">echo</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span>
<span class="token punctuation">}</span>

<span class="token assign-left variable">DEL_SIZE_G</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token assign-left variable">DEL_AGE_DAY</span><span class="token operator">=</span><span class="token variable">$2</span>

<span class="token assign-left variable">DEL_SIZE_B</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$DEL_SIZE_G <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token variable">))</span></span>

<span class="token comment"># 打印执行时间</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Start time: <span class="token variable"><span class="token variable">$(</span><span class="token function">date</span><span class="token variable">)</span></span> 参数：删除大小阈值 <span class="token variable">$DEL_SIZE_G</span> GB，删除年龄阈值 <span class="token variable">$DEL_AGE_DAY</span> 天&quot;</span>
<span class="token comment"># 调用函数</span>
del_by_size <span class="token variable">$DEL_SIZE_B</span>
del_by_age <span class="token variable">$DEL_AGE_DAY</span>
<span class="token comment"># 打印执行时间</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;End time: <span class="token variable"><span class="token variable">$(</span><span class="token function">date</span><span class="token variable">)</span></span>&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br></div></div><p>命令行执行 <code>crontab -e</code>，将脚本加入到定时任务中：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">0</span> <span class="token number">0</span> * * * /bin/bash /path/to/delete_index.sh <span class="token number">20</span> <span class="token number">90</span> <span class="token operator">&gt;&gt;</span> /path/to/delete_index.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/felix-wj/felix-wj.github.io.git/edit/master/docs/_posts/020.skywalking.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/11/27, 13:48:55</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/G1-garbage-collector-parameters-optimization/"><div>G1垃圾收集器的参数调优</div></a> <span>02-23</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/jvm-memory-problem/"><div>内存占用过大排查</div></a> <span>01-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/docker-compose/"><div>docker-compose笔记</div></a> <span>01-12</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1358726405@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/felix-wj" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2025
    <span>Felix Ww | <a href="https://beian.miit.gov.cn/" target="_blank">浙ICP备18048863号-1</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.eb9ad15b.js" defer></script><script src="/assets/js/2.23133a41.js" defer></script><script src="/assets/js/96.cbda6537.js" defer></script>
  </body>
</html>
